## 引言

菜狗突然想讲点东西……很多地方用词没有那么严谨，很多方法是个人习惯使用的，如有错误欢迎指正！

### 我们想探究的问题

我想讲的问题：double和float的区别

从长度开始

![image-20231031193535205](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031193535205.png)

![image-20231031193553426](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031193553426.png)

![image-20231031193604347](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031193604347.png)

- 什么是位宽？16？32？64？

- 什么是字节？
- 8 1000

### 字节

<img src="https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031194415112.png" alt="image-20231031194415112" style="zoom:50%;" />

<img src="https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031194343064.png" alt="image-20231031194343064" style="zoom:50%;" />

### 位宽

<img src="https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031193743478.png" alt="image-20231031193743478" style="zoom:50%;" />

[64位的电脑是什么意思？]( https://zhuanlan.zhihu.com/p/113548852)

![image-20231031194236270](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031194236270.png)

为什么是4G?

CPU是计算机的控制中心，能够控制到内存的每一个字节（位置），他需要能做到到达内存的所有位置

内存地址编号：

0x000000001 0x000000002 0x000000003 ……  0xfffffffff ----9位十六进制数----36位二进制数 32位二进制数无法表达 超了！

0x00000001 0x00000002 0x00000003 ……  0xffffffff ----8位十六进制数----32位二进制数 32位二进制数可以表达 刚好！

2^32 = ……bits = ……byte = …… = 4G



## 进制转换

### 10->2

#### 整数

方法一：除2

<img src="https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031192102464.png" alt="image-20231031192102464" style="zoom:67%;" />

方法二：

<img src="https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031191901072.png" alt="image-20231031191901072" style="zoom: 50%;" />

 53 = 32 + 16 + 4 + 1 = 1 x 2^0 + 0 x 2^ 1 +2^2 + 2^4 + 2^5 

11011(2) = 53(10)

#### 小数   0000.0000

0.5 0 0.5 0000.1000

1.75 1 0.75    0.75=0.5 + 0.25 =  11   ----  1.11   

8 4 4    0001.1100  

将整数和小数分开算 然后合并在一起！

整数的算法参考上面！

方法一：

![image-20231031192207440](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031192207440.png)

算一下！

5.64

6.345

7.691

### 2->10

![image-20231031191634693](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031191634693.png)

- 十进制逢十进一，那二进制呢？ 逢二进一！

![image-20231031191711844](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031191711844.png)



### 2->16 16->2

4位二进制数能表示哪些数？

| 二进制 | 十进制 | 十六进制 |
| ------ | ------ | -------- |
| 0000   | 0      | 0        |
| 0001   | 1      | 1        |
| 0010   | 2      | 2        |
| 0011   | 3      | 3        |
| 0100   | 4      | 4        |
| 0101   | 5      | 5        |
| 0110   | 6      | 6        |
| 0111   | 7      | 7        |
| 1000   | 8      | 8        |
| 1001   | 9      | 9        |
| 1010   | 10     | A        |
| 1011   | 11     | B        |
| 1100   | 12     | C        |
| 1101   | 13     | D        |
| 1110   | 14     | E        |
| 1111   | 15     | F        |

你发现了什么？

4位二进制数<->一位十六进制数

所以，你会二进制与十六进制之间的转换了吗？ 有手就行！

| 二进制    | 十进制 | 十六进制 |
| --------- | ------ | -------- |
| 0000 0010 |        |          |
| 0001 0110 |        |          |
| 0010 1101 |        |          |
| 0011 0101 |        |          |
| 0100 1111 |        |          |

## 定点数和浮点数

参考文章：

- [什么是定点数？ - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/338588296)
- [什么是浮点数？ - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/339949186)

#### 定点数 0.5    0000.1000

复用文章：[什[么是定点数？ - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/338588296)

![image-20231031192959559](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031192959559.png)

#### 浮点数

推荐文章：[什么是浮点数？ - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/339949186)

![image-20231031200310660](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031200310660.png)





![image-20231031200513951](C:\Users\Chelsea\AppData\Roaming\Typora\typora-user-images\image-20231031200513951.png)

规格化：规定小数点前只有一位非零数（1）

- 既然有了规格化，二进制中基为2，那么这两部分的数都是已知的确定的，所以我们接下来只需要对尾数、指数分别编码！

- 注意喔！介个是**二进制表示**的实数喔！

  - 也就是如果你手里有一个十进制数，你想将其转化为浮点数形式，你需要先将其化为二进制表示的形式，然后将其转换为以2为基的二进制版科学计数法形式！

    如111.1011->1.111011 x 2^2     10111.11-> 1.011111 x 2^4

接下来分别说一下指数、尾数的表示

- 阶码（指数表示形式）：先将指数化为二进制有符号数，然后用移码！

  - 有符号数例如 一个8位有符号数 第一位为符号位 

    - -1 ->  1000 0001

  - 移码？

    - 什么是移码表示？

      将每一个数值（二进制形式）加上一个偏置常数

    - ？？为啥搞那么麻烦 用原本的数不行吗？？

      便于浮点数加减运算时的对阶操作！（比较大小）

      可以使0的表示方式唯一化（让0只有一种表示方式）（这里要去学原码 补码 反码）（有的表示会分+0和-0）

      ![image-20231031201242208](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031201242208.png)

    - 偏置常数用哪个数？

      ![image-20231031201408444](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031201408444.png)

      移码和补码仅第一位不同，补码的知识大家自己补一下！这个也很重要！

      8

| 原码（数的二进制表示得到的结果） | 补码 | 移码 | 十进制  |
| -------------------------------- | ---- | ---- | ------- |
| 1 111                            | 1001 | 0001 | -7 -> 1 |
| 1 110                            | 1010 | 0010 | -6 -> 2 |
| 0 000                            | 0000 | 1000 | 0 -> 8  |
| 0 111                            | 0111 | 1111 | 7 -> 15 |

这是4位有符号数，你会发现这样的转换很像是将有符号数转为无符号数（个人理解）（理解方式）

![image-20231031202303633](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031202303633.png)

这个比较大小的做法，其实也可以理解为将指数去符号化！

- 尾数
  - 将数规格化之后，小数点后面的部分
  - 如111.11011->1.1111011 x 2^2     10111.11-> 1.011111 x 2^4
  - 111.11011的尾数->1111011  
  - 10111.11的尾数->011111

![image-20231031205422000](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031205422000.png)

| 二进制小数 |                  | 符号位 | 指数                   | 阶码      | 浮点数表示                          |
| ---------- | ---------------- | ------ | ---------------------- | --------- | ----------------------------------- |
| 111.101001 | 1.11101001 x 2^2 | 0      | 2 -- 0000 0010---129   | 1000 0001 | 0 1000 0001 11101001000000000000000 |
| 0.0010011  | 1.0011 x 2^(-3)  | 0      | -3 --- 1000 0011---124 |           |                                     |
| 11101.0011 | 1.11010011 x 2^4 | 0      | 4 -- 0000 0100---131   |           |                                     |
| -1011.1011 | -1.0111011 x 2^3 | 1      | 3 --- 0000 0011---130  |           |                                     |

- 符号位：正数0 负数1

- 32位数 1位符号位 8位阶码 23位尾数 偏置常数127   0111 1111

- 

  

- 早期的计算机，各自定义自己的浮点数格式
  - 基可以是 2 4 8 16
  - 很多地方的表示方法都可以不一样
- 浮点数表示不统一会带来什么问题？
  - 程序可移植性：如果不同计算机体系结构或编程语言使用不同的浮点数表示，可能会导致程序在不同平台上产生不一致的结果。这会影响程序的可移植性，使其难以在不同环境中运行。
  - ……
  - <img src="https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031203946419.png" alt="image-20231031203946419" style="zoom:50%;" />

## 浮点数的机器表示IEEE标准

- ![image-20231031211033782](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031211033782.png)

  为什么不是0000 0000 ~ 1111 1111？

  后面会说 他俩有别的用处！

  ![image-20231031211053011](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031211053011.png)

  ![image-20231031211121972](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031211121972.png)

  

  - float单精度：1位符号位+八位阶码+23位尾数-32位
  - double双精度：1位符号位+11位阶码+52位尾数-64位

为什么这里的偏置常数用了127而不是128？我也还没搞清楚……

![image-20231031210930378](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031210930378.png)

![image-20231031211215267](https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031211215267.png)

<img src="https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031195938406.png" alt="image-20231031195938406" style="zoom:50%;" />

<img src="https://chelsea12.oss-cn-beijing.aliyuncs.com/image-20231031195954510.png" alt="image-20231031195954510" style="zoom:50%;" />



**附带了汉章学长去年给我们讲浮点数的文档！**

## 浮点数的机器表示 IEEE标准（by汉章学长）

```c
float a = 0.1; //无限不循环
float b = 0.2;
if(a + b == 0.1 + 0.2)
    printf("1");
s 8 23
```

#### 形式

```c
V = (-1)^s * M * 2^E
    科学计数法
    A * 10^X
```

符号位 sign 1 0

尾数 significant  .后

阶码 exponent 前.

1010101 1.010101 \* 10^6

不是全0 全1 

32位 int

s | 00000000 | 23

s | 11111111 | 23

00.111

01.11 \* 2  

#### 规格化

偏置量 biased 

阶码E = e - Bias 其中Bias = 2^(k-1) - 1 127 E -124

尾数M = 1 + f M 0-1 1-2

01.101
（1 + f）\* 2 ^ (e - 2^(k-1) + 1)

mul div -Og 

-O1 << >> 



#### 非规格化

E = 1- Bias (违反直觉？) -> 补偿规格化的M的1

M = f

用处？

1.   表示“0” 
2.   表示非常接近0的数字 “逐渐下溢”

### 特殊值

e全1 f全0 无穷

f非全0 NAN(not a number)

1/0

#### 做题！

BIAS = 1

| 位      | e    | E    | 2^E  | f    | M    | 2^E * M | V    | Dec  |
| ------- | ---- | ---- | ---- | ---- | ---- | ------- | ---- | ---- |
| 0 00 00 | 0    | 0    |      | 0    |      |         |      |      |
| 0 00 01 | 0    | 0    |      | 1/4  |      |         |      |      |
| 0 00 10 | 0    | 0    |      | 1/2  |      |         |      |      |
| 0 00 11 | 0    | 0    |      | 3/4  |      |         |      |      |
| 0 01 00 | 1    | 0    |      |      | 1    |         |      |      |
| 0 01 01 | 1    | 0    | 1    |      | 5/4  | 5/2     |      | 2.5  |
| 0 01 10 | 1    | 0    |      |      | 3/2  |         |      |      |
| 0 01 11 | 1    | 0    |      |      | 7/4  |         |      |      |
| 0 10 00 | 2    | 1    |      |      |      |         |      |      |
| 0 10 01 | 2    | 1    |      |      |      |         |      |      |
| 0 10 10 | 2    | 1    |      |      |      |         |      |      |
| 0 10 11 | 2    | 1    |      |      |      |         |      |      |
| 0 11 00 | 3    | 无穷 |      |      |      |         |      |      |
| 0 11 01 | 3    | NAN  |      |      |      |         |      |      |
| 0 11 10 | 3    | NAN  |      |      |      |         |      |      |
| 0 11 11 | 3    | NAN  |      |      |      |         |      |      |

#### 再来！

![image-20221112181827088](C:\Users\Roxe\AppData\Roaming\Typora\typora-user-images\image-20221112181827088.png)

#### 舍入

向偶数舍入(向最接近值的舍入) -> 避免统计偏差

1.3 1 1.7 2

0 0110 110 0.875

0 0111 000 1

向零舍入

向上舍入

向下舍入

#### 结尾做题再来一道

非负

格式A: k = 3 n = 4

格式B: k = 4 n = 3

从A转换到B

E = e - bias M = 1 + f 规格化

E = 1- bias M = f	非规格化

bias = 2^(k-1) - 1 

V = (-1)^s * M * 2^E

| 格式A    |       | 格式B    |      |
| -------- | ----- | -------- | ---- |
| 位       | 值    | 位       | 值   |
| 011 0000 | 1     | 0111 000 | 1    |
| 101 1110 | 15/2  | 1010 111 | 15/2 |
| 010 1001 | 25/32 | 0110 100 | 3/4  |
| 110 1111 |       |          |      |
| 000 0001 | 1/64  |          |      |

| e    | E    | f     | M     |
| ---- | ---- | ----- | ----- |
| 5    | 2    | 7/8   | 15/8  |
| 2    | -1   | 9/16  | 25/16 |
| 6    | 3    | 15/16 | 31/16 |
| 0    | -2   | 1/16  | 1/64  |
|      |      |       |       |
|      |      |       |       |

